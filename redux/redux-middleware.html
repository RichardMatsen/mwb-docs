<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux Middleware | MWB Documentation</title>
    <meta name="description" content="Data migration workbench">
    
    
    <link rel="preload" href="/mwb-docs/assets/css/0.styles.f856d471.css" as="style"><link rel="preload" href="/mwb-docs/assets/js/app.a7583053.js" as="script"><link rel="preload" href="/mwb-docs/assets/js/21.6c516c23.js" as="script"><link rel="preload" href="/mwb-docs/assets/js/7.8a1efbd8.js" as="script"><link rel="prefetch" href="/mwb-docs/assets/js/14.63eaeec2.js"><link rel="prefetch" href="/mwb-docs/assets/js/2.cd3fbe18.js"><link rel="prefetch" href="/mwb-docs/assets/js/3.e5d6ffde.js"><link rel="prefetch" href="/mwb-docs/assets/js/4.5aee960d.js"><link rel="prefetch" href="/mwb-docs/assets/js/5.31efbd1b.js"><link rel="prefetch" href="/mwb-docs/assets/js/6.a75e5a13.js"><link rel="prefetch" href="/mwb-docs/assets/js/8.43eff26f.js"><link rel="prefetch" href="/mwb-docs/assets/js/9.4257e60b.js"><link rel="prefetch" href="/mwb-docs/assets/js/10.b23970bc.js"><link rel="prefetch" href="/mwb-docs/assets/js/11.21e89f2a.js"><link rel="prefetch" href="/mwb-docs/assets/js/12.c9ded795.js"><link rel="prefetch" href="/mwb-docs/assets/js/13.7569e760.js"><link rel="prefetch" href="/mwb-docs/assets/js/15.15d8439f.js"><link rel="prefetch" href="/mwb-docs/assets/js/16.003eec02.js"><link rel="prefetch" href="/mwb-docs/assets/js/17.d272c3f2.js"><link rel="prefetch" href="/mwb-docs/assets/js/18.28d2d373.js"><link rel="prefetch" href="/mwb-docs/assets/js/19.6f14f780.js"><link rel="prefetch" href="/mwb-docs/assets/js/20.5a0ab772.js"><link rel="prefetch" href="/mwb-docs/assets/js/22.eb780789.js"><link rel="prefetch" href="/mwb-docs/assets/js/23.d60688de.js"><link rel="prefetch" href="/mwb-docs/assets/js/24.e0c7f95f.js"><link rel="prefetch" href="/mwb-docs/assets/js/25.a03bcc83.js"><link rel="prefetch" href="/mwb-docs/assets/js/26.e7229fbe.js"><link rel="prefetch" href="/mwb-docs/assets/js/27.5b7facd5.js"><link rel="prefetch" href="/mwb-docs/assets/js/28.f7daa03e.js"><link rel="prefetch" href="/mwb-docs/assets/js/29.fa78f538.js"><link rel="prefetch" href="/mwb-docs/assets/js/30.6e46af23.js"><link rel="prefetch" href="/mwb-docs/assets/js/31.9c9aa942.js"><link rel="prefetch" href="/mwb-docs/assets/js/32.2dc8a33b.js"><link rel="prefetch" href="/mwb-docs/assets/js/33.4f0214a4.js"><link rel="prefetch" href="/mwb-docs/assets/js/34.bcdd55ce.js"><link rel="prefetch" href="/mwb-docs/assets/js/35.08bcc98d.js"><link rel="prefetch" href="/mwb-docs/assets/js/36.39c27025.js"><link rel="prefetch" href="/mwb-docs/assets/js/37.2bb75089.js"><link rel="prefetch" href="/mwb-docs/assets/js/38.30e861d1.js">
    <link rel="stylesheet" href="/mwb-docs/assets/css/0.styles.f856d471.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mwb-docs/" class="home-link router-link-active"><!----> <span class="site-name">MWB Documentation</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mwb-docs/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/mwb-docs/measure-calculation/" class="nav-link">Measure Calculation</a></div><div class="nav-item"><a href="/mwb-docs/dashboard-thumbnail/" class="nav-link">DashboardThumbnail</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Redux Store</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-store.html" class="nav-link">Overview</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-middleware.html" class="nav-link router-link-exact-active router-link-active">Middleware</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-selector-helpers.html" class="nav-link">Selector Helpers</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-computed-state.html" class="nav-link">Computed State</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-observable-arrays.html" class="nav-link">Observable Arrays</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-reducer-testing.html" class="nav-link">Reducer Testing</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Testing</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/cypress-e2e-tests.html" class="nav-link">Cypress e2e Testing</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/cypress-test-results.html" class="nav-link">Cypress Test Results</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/unit-test-results.html" class="nav-link">Unit Tests</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/code-coverage.html" class="nav-link">Code Coverage</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/webpack-bundle-analyzer-results.html" class="nav-link">Webpack Bundle Analyzer</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/npm-audit.html" class="nav-link">npm audit security report</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/RichardMatsen/mwb-v2-redux" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mwb-docs/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/mwb-docs/measure-calculation/" class="nav-link">Measure Calculation</a></div><div class="nav-item"><a href="/mwb-docs/dashboard-thumbnail/" class="nav-link">DashboardThumbnail</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Redux Store</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-store.html" class="nav-link">Overview</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-middleware.html" class="nav-link router-link-exact-active router-link-active">Middleware</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-selector-helpers.html" class="nav-link">Selector Helpers</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-computed-state.html" class="nav-link">Computed State</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-observable-arrays.html" class="nav-link">Observable Arrays</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/redux/redux-reducer-testing.html" class="nav-link">Reducer Testing</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Testing</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/cypress-e2e-tests.html" class="nav-link">Cypress e2e Testing</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/cypress-test-results.html" class="nav-link">Cypress Test Results</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/unit-test-results.html" class="nav-link">Unit Tests</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/code-coverage.html" class="nav-link">Code Coverage</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/webpack-bundle-analyzer-results.html" class="nav-link">Webpack Bundle Analyzer</a></li><li class="dropdown-item"><!----> <a href="/mwb-docs/testing/npm-audit.html" class="nav-link">npm audit security report</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/RichardMatsen/mwb-v2-redux" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Redux Middleware</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/mwb-docs/redux/redux-middleware.html#freezestate" class="sidebar-link">freezeState</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mwb-docs/redux/redux-middleware.html#httpmiddleware" class="sidebar-link">httpMiddleware</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mwb-docs/redux/redux-middleware.html#uimiddleware" class="sidebar-link">uiMiddleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mwb-docs/redux/redux-middleware.html#ui-middleware-type-and-factory" class="sidebar-link">UI middleware type and factory</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="redux-middleware"><a href="#redux-middleware" aria-hidden="true" class="header-anchor">#</a> Redux Middleware</h1> <h2 id="freezestate"><a href="#freezestate" aria-hidden="true" class="header-anchor">#</a> <strong>freezeState</strong></h2> <p>freezeState is a middleware function that ensures the state remains immutable.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">freezeState</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">deepFreeze</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Technically, the purpose of this middleware is to insure the reducers do not mutate state. When mutation occurs, an error is thrown since state is frozen at all levels of the tree (deep frozen).<br>
The functionality is not needed in production since the reducers are in final/released state. Therefore, we conditionally add this middleware during development only.</p> <div class="language-javascript extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-javascript"><code><span class="token keyword">const</span> middleware <span class="token operator">=</span>
  <span class="token punctuation">(</span>environment<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>freezeState<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>httpMiddleware<span class="token punctuation">.</span><span class="token function">httpMiddlewareFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uiMiddleware<span class="token punctuation">.</span><span class="token function">uiMiddlewareFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>ngRedux<span class="token punctuation">.</span><span class="token function">configureStore</span><span class="token punctuation">(</span>
  rootReducer<span class="token punctuation">,</span>
  appInitialState<span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token operator">...</span>middleware<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>devTools<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span> <span class="token keyword">this</span><span class="token punctuation">.</span>devTools<span class="token punctuation">.</span><span class="token function">enhancer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> predicate<span class="token punctuation">:</span> includeActions <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Testing the <code>freezeState</code> function</p> <div class="language-javascript extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mockStore <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span><span class="token string">'mockStore'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'dispatch'</span><span class="token punctuation">,</span> <span class="token string">'getState'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mockStore<span class="token punctuation">.</span>getState<span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mockNext <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpy</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'NOP'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should freeze state'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">freezeState</span><span class="token punctuation">(</span>mockStore<span class="token punctuation">)</span><span class="token punctuation">(</span>mockNext<span class="token punctuation">)</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// tslint:disable-next-line:quotemark</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> state<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot assign to read only property 'x' of object '[object Object]'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="httpmiddleware"><a href="#httpmiddleware" aria-hidden="true" class="header-anchor">#</a> <strong>httpMiddleware</strong></h2> <p>This provides common code for http get requests initiated via actions.<br>
The middleware is triggered if the action has a property <code>httpRequest</code>.</p> <ul><li>maps to success action or failure action</li> <li>validation of response (optional)</li> <li>triggers and removes UI loading indicator</li> <li>specifies 404 page message (optional)</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> type HttpRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  successAction<span class="token punctuation">:</span> Function<span class="token punctuation">,</span>      <span class="token comment">// action creator for success, data passed in</span>
  failedAction<span class="token punctuation">:</span> Function<span class="token punctuation">,</span>       <span class="token comment">// action creator for failure, error passed in</span>
  validateResponse<span class="token operator">?</span><span class="token punctuation">:</span> Function<span class="token punctuation">,</span>  <span class="token comment">// validate the response, call successAction or failedAction</span>
  four0FourMessage<span class="token operator">?</span><span class="token punctuation">:</span> string     <span class="token comment">// message for 404 page, when return status is 404</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="uimiddleware"><a href="#uimiddleware" aria-hidden="true" class="header-anchor">#</a> <strong>uiMiddleware</strong></h2> <p>The UI middleware is used to turn a spinner on and off when a long-running process executes.<br>
The <strong>spinner component template</strong> is conditionally shown depending on the store property <code>activeRequests</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token punctuation">:</span> <span class="token string">'mwb-spinner'</span><span class="token punctuation">,</span>
  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
    &lt;div class=&quot;loading-overlay&quot; *ngIf=&quot;(activeRequests$ | async) &gt; 0&quot;&gt;
      &lt;i class=&quot;center-fix main-spinner fa fa-spin fa-spinner&quot;&gt;&lt;/i&gt;
    &lt;/div&gt;
  `</span></span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SpinnerComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ui'</span><span class="token punctuation">,</span> <span class="token string">'activeRequests'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> activeRequests$<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When a service wants to flag a long-running process, it dispatches an action with the <code>uiStartLoading</code> property.<br>
It then signals completion by dispatching another action with the <code>uiEndLoading</code> property.</p> <p>For example, when measures are calculated there is formatting and aggregation taking place that is long enough to justify spinner display.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MeasureActions</span> <span class="token punctuation">{</span>

  <span class="token keyword">static</span> <span class="token constant">INITIALIZE_MEASURES_REQUEST</span> <span class="token operator">=</span> <span class="token string">'INITIALIZE_MEASURES_REQUEST'</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token constant">INITIALIZE_MEASURES_SUCCESS</span> <span class="token operator">=</span> <span class="token string">'INITIALIZE_MEASURES_SUCCESS'</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token constant">INITIALIZE_MEASURES_FAILED</span>  <span class="token operator">=</span> <span class="token string">'INITIALIZE_MEASURES_FAILED'</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token function">createInitializeMeasuresRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> MeasureActions<span class="token punctuation">.</span><span class="token constant">INITIALIZE_MEASURES_REQUEST</span><span class="token punctuation">,</span>
      uiStartLoading<span class="token punctuation">:</span> MeasureActions<span class="token punctuation">.</span><span class="token constant">INITIALIZE_MEASURES_REQUEST</span><span class="token punctuation">,</span>
      excludeFromLog<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
  <span class="token function">createInitializeMeasuresSuccess</span><span class="token punctuation">(</span>measures<span class="token punctuation">:</span> IMeasure<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> MeasureActions<span class="token punctuation">.</span><span class="token constant">INITIALIZE_MEASURES_SUCCESS</span><span class="token punctuation">,</span>
      uiEndLoading<span class="token punctuation">:</span> MeasureActions<span class="token punctuation">.</span><span class="token constant">INITIALIZE_MEASURES_SUCCESS</span><span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> measures <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
  <span class="token function">createInitializeMeasuresFailed</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> MeasureActions<span class="token punctuation">.</span><span class="token constant">INITIALIZE_MEASURES_FAILED</span><span class="token punctuation">,</span>
      uiEndLoading<span class="token punctuation">:</span> MeasureActions<span class="token punctuation">.</span><span class="token constant">INITIALIZE_MEASURES_FAILED</span><span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> measures<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">errorMeasure</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>Note that the ui state <code>activeRequests</code> property allows for multiple concurrent triggers (the spinner is shown as long as activeRequests &gt; 0).</p> <h3 id="ui-middleware-type-and-factory"><a href="#ui-middleware-type-and-factory" aria-hidden="true" class="header-anchor">#</a> UI middleware type and factory</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> type UiActionType <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  payload<span class="token operator">?</span><span class="token punctuation">:</span> UiState<span class="token punctuation">,</span>          <span class="token comment">// Constrain payload to match UiState</span>
  trigger<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">,</span>           <span class="token comment">// Show which action triggered this action</span>
  excludeFromLog<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>   <span class="token comment">// Devtools enhancer will filter from the log</span>
  message<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">,</span>           <span class="token comment">// Message to display on the 404 screen</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">uiMiddlewareFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">uiMiddleware</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>uiStartLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span>uiActions<span class="token punctuation">.</span><span class="token function">incrementLoading</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>uiEndLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span>uiActions<span class="token punctuation">.</span><span class="token function">decrementLoading</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>action<span class="token punctuation">.</span>toastr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span>toastr<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>toastr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="minimap-container" style="width:250px;" data-v-5f41ee3b><div class="minimap" style="top:250px;zoom:25%;" data-v-5f41ee3b><div data-v-5f41ee3b></div></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/3/2018, 8:47:06 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/mwb-docs/assets/js/21.6c516c23.js" defer></script><script src="/mwb-docs/assets/js/7.8a1efbd8.js" defer></script><script src="/mwb-docs/assets/js/app.a7583053.js" defer></script>
  </body>
</html>
